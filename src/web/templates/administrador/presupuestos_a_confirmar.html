{% extends "_layouts/app.html" %}
{% import "_macros/table.html" as Table %}

{% block head %}
<title>Presupuestos a Confirmar</title>
<style>
  /* Estilos para el toggle switch */
  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
    overflow: visible; /* Asegurar que el tooltip no se corte */
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
    z-index: 1; /* Asegurar que el toggle esté debajo del tooltip */
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: #2196F3;
  }

  input:checked + .slider:before {
    transform: translateX(26px);
  }

  .tooltip {
    position: absolute;
    background-color: black;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none; /* Evitar que el mouse interactúe con el tooltip */
    white-space: nowrap; /* Evitar que el texto se divida */
    z-index: 100; /* Asegurar que el tooltip esté en el frente */
    transform: translateX(-50%);
    left: 50%; /* Centrar horizontalmente */
    bottom: 45px; /* Ajustar el tooltip encima del toggle */
  }
</style>
{% endblock %}

{% block content %}
<main class="flex flex-col items-center min-h-screen">
  <section class="px-4 py-12 w-full max-w-4xl text-center">
    <div>
      <h1 class="mb-4 text-3xl font-extrabold text-indigo-800 md:text-4xl lg:text-5xl">
        Lista de Presupuestos a Confirmar
      </h1>
      <p class="mb-4 text-base md:text-lg text-zinc-500">
        A continuación se muestra una lista de presupuestos a confirmar.
      </p>
    </div>

    <div class="overflow-x-auto w-full">
      <h2 class="my-4 text-2xl font-bold">Presupuestos</h2>
      {% call Table.Table() %}
      {{ Table.TableHeader(("Fecha de Vencimiento", "Monto", "Detalle", "Confirmar Pago")) }}
      <tbody>
        {% for presupuesto in presupuestos %}
        <tr class="text-black bg-very-light-yellow-green">
          <td class="py-4 whitespace-normal break-words">
            {{ presupuesto.fecha_vencimiento.strftime('%d/%m/%Y') }}
          </td>
          <td class="py-4 whitespace-normal break-words">
            {{ presupuesto.montoFinal }}
          </td>
          <td class="py-4 whitespace-normal break-words">
            {{ presupuesto.Detalle }}
          </td>
          <td class="py-4 whitespace-normal break-words">
            <form method="POST" action="/presupuestos_a_confirmar" class="flex relative items-center">
              <input type="hidden" name="presupuesto_id" value="{{ presupuesto.id }}">
              <input type="hidden" name="nuevo_estado" value="{{ 'PAGADO' if presupuesto.estado == 'PAGADO' else 'PENDIENTE' }}">
              <label class="switch">
                <input type="checkbox" name="estado" 
                  {% if presupuesto.estado == 'PENDIENTE' %}checked{% endif %}
                  onchange="this.form.submit()">
                <span class="slider" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)"></span>
                <span class="tooltip">{{ 'Confirmar Pago' if presupuesto.estado == 'PENDIENTE' else 'Confirmar Pago' }}</span>
              </label>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      {% endcall %}
    </div>
  </section>
</main>
{% endblock %}