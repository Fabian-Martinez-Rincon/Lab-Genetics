{% extends "_layouts/app.html" %}

{% block head %}
<title>Presupuesto del Estudio</title>
{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center px-4 py-12 sm:px-6 lg:px-8">
  <div class="w-full max-w-2xl p-8 transition-all duration-300 transform bg-white shadow-xl rounded-xl hover:shadow-2xl">
    <h1 class="mb-6 text-4xl font-extrabold text-center text-indigo-700">Presupuesto del Estudio</h1>

    <div class="space-y-4 text-gray-800">
      <p class="text-lg"><strong class="text-indigo-600">ID Estudio:</strong> {{ estudio.id }}</p>
      <p class="text-lg"><strong class="text-indigo-600">Fecha de Vencimiento:</strong> {{ presupuesto.fecha_vencimiento.strftime('%d/%m/%Y') }}</p>
      <p class="text-lg"><strong class="text-indigo-600">Detalle:<br></strong>
        {{ presupuesto.Detalle
            .replace('Patologías a Evaluar:', '<strong>Patologías a Evaluar:</strong>')
            .replace('Genes a Evaluar:', '<strong>Genes a Evaluar:</strong>')
            .replace('Genes Adicionales Solicitados:', '<strong>Genes Adicionales Solicitados:</strong>')
            .replace('Se Solicitaron Hallazgos Secundarios', '<strong>Se Solicitaron Hallazgos Secundarios</strong>')
            .replace('Detalle de Precio:', '<strong class="text-indigo-600">Detalle de Precio:</strong>')
            .replace('\n', '<br>') | safe }}
      </p>      
      <p class="text-lg"><strong class="text-indigo-600">Monto Final:</strong> {{ presupuesto.montoFinal | round(2) }}</p>
    </div>

    {% if presupuesto.comprobante_path %}
      <div class="mt-4">
        <p class="text-lg"><strong class="text-indigo-600">Comprobante:</strong>
        <a href="{{ url_for('static', filename=presupuesto.comprobante_path) }}" target="_blank" class="text-indigo-600 underline hover:text-indigo-800">
          Ver Comprobante
       </a> </p>
      </div>
    {% endif %}
    {% if (presupuesto.id_estado == 1) or (presupuesto.id_estado == 4) %}
      <form action="{{ url_for('listar.presupuesto_estudio', estudio_id=estudio.id) }}" method="post" enctype="multipart/form-data">
        <div class="mt-4">
          <label for="comprobante" class="text-lg text-indigo-600"><strong class="text-indigo-600">Subir Comprobante(Imagen o PDF):</strong></label>
          <input type="file" name="comprobante" id="comprobante" class="block w-full mt-2">
        </div>

        <div class="mt-8 text-center">
          <button type="submit" class="inline-block px-4 py-2 font-semibold text-white transition duration-300 bg-green-600 rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg">
            Guardar Comprobante
          </button>
    {% else %}   
        <div class="mt-8 text-center">
    {% endif %}

    
      <a href="{{ url_for('listar.detalle_estudio', estudio_id=estudio.id) }}" 
         class="inline-block px-4 py-2 font-semibold text-white transition duration-300 bg-indigo-600 rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg">
        Volver al Estudio
      </a>
    </div>
  </div>
</div>
{% endblock %}
